<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>

<script>

function loadForm(parameterData) {

  $("form#create-bill").html(() => {

    return parameterData.map(function(parameter) {
    
      switch(parameter['parameter-type']) {
      
        case 'one-line' : 
          return `<div class="form-group"><label for="${parameter['parameter-title']}">${parameter['column-title']}</label><input type="text" name="${parameter['parameter-title']}"/></div>`;
          break;
        
        case 'account-select' :
          return `<div class="form-group"><label for="${parameter['parameter-title']}">${parameter['column-title']}</label><input type="text" name="${parameter['paramater-title']}" class="autocomplete-accounts"/></div>`; 
          break; 

        default : 
          return '<div>' + parameter['parameter-title'] + '</div>';
          ;
      
      }
    
    });
    
  });

  google.withSuccessHandler(loadAutocomplete).getPipedriveAccounts();
}

function loadAutocomplete(accountsData) {

  let accountsName = [];
  accountsName = accountsData.map((element) => {
    return element['org_name'];
  });

  $(".account-autocomplete").autocomplete({
    source: accountsName
  });
}

$(document).ready(function() {

  google.script.run.withSuccessHandler(loadForm).getParameterData();

});

</script>

